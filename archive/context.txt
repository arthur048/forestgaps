Prompt de Contexte Global: ForestGaps-DL Package Refactorisation
Vue d'ensemble du projet
Ce projet consiste Ã  refactoriser deux scripts monolithiques (forestgaps_dl_data_preparation.py et forestgaps_dl_u_net_training.py) en un package Python modulaire pour la dÃ©tection de trouÃ©es forestiÃ¨res par deep learning. Le code utilise PyTorch et des techniques de traitement d'images gÃ©ospatiales pour dÃ©tecter les trouÃ©es forestiÃ¨res Ã  partir de modÃ¨les numÃ©riques de surface (DSM) et de hauteur de canopÃ©e (CHM).
Objectifs principaux de la refactorisation

Transformer le code en package Python modulaire suivant les principes SOLID
CrÃ©er une configuration externalisÃ©e avec validation
Optimiser les pipelines de donnÃ©es et d'entraÃ®nement
Maintenir la compatibilitÃ© avec Google Colab
Assurer l'extensibilitÃ© pour de nouvelles architectures et fonctionnalitÃ©s

ARCHITECTURE DU PACKAGE:
forestgaps_dl/
â”œâ”€â”€ config/                 # âœ… SystÃ¨me de configuration avec validation
â”œâ”€â”€ environment/            # âœ… Abstractions pour diffÃ©rents environnements (Colab, local)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ preprocessing/      # âœ… PrÃ©traitement des rasters (alignement, analyse, conversion)
â”‚   â”œâ”€â”€ datasets/           # âœ… Classes Dataset PyTorch et gestion des transformations
â”‚   â”œâ”€â”€ normalization/      # âœ… StratÃ©gies de normalisation adaptatives
â”‚   â””â”€â”€ loaders/            # âœ… Optimisation des DataLoaders (Ã  implÃ©menter)
â”œâ”€â”€ models/                 # ğŸ”„ Architectures U-Net et leurs variantes (Ã  implÃ©menter)
â”‚   â”œâ”€â”€ blocks/             # Blocs architecturaux rÃ©utilisables
â”‚   â”œâ”€â”€ attention/          # MÃ©canismes d'attention (CBAM, etc.)
â”‚   â”œâ”€â”€ film/               # Feature-wise Linear Modulation
â”‚   â””â”€â”€ unet/               # ImplÃ©mentations U-Net
â”œâ”€â”€ training/               # ğŸ”„ Boucles d'entraÃ®nement et Ã©valuation (Ã  implÃ©menter)
â”‚   â”œâ”€â”€ callbacks/          # SystÃ¨me de callbacks modulaire
â”‚   â”œâ”€â”€ loss/               # Fonctions de perte personnalisÃ©es
â”‚   â”œâ”€â”€ metrics/            # MÃ©triques d'Ã©valuation
â”‚   â””â”€â”€ scheduler/          # StratÃ©gies d'ajustement du learning rate
â”œâ”€â”€ utils/                  # ğŸ”„ Utilitaires gÃ©nÃ©riques (Ã  implÃ©menter)
â””â”€â”€ cli/                    # ğŸ”„ Interface en ligne de commande (Ã  implÃ©menter)

Ã‰tat d'avancement

âœ… TerminÃ©: config/, environment/, data/preprocessing/, data/datasets/, data/normalization/
ğŸ”„ En cours: data/loaders/
â³ Ã€ faire: models/, training/, utils/, cli/

DÃ©pendances entre modules

config/: Base indÃ©pendante utilisÃ©e par tous les autres modules
environment/: UtilisÃ© par tous les modules nÃ©cessitant une adaptation Ã  Colab
data/preprocessing/: DÃ©pend de config/ et environment/
data/datasets/: DÃ©pend de preprocessing/ et config/
data/normalization/: DÃ©pend de preprocessing/ et config/
data/loaders/: DÃ©pendra de datasets/ et normalization/
models/: DÃ©pendra de config/ et normalization/
training/: DÃ©pendra de models/, data/loaders/ et config/

Principes de dÃ©veloppement Ã  respecter

SOLID:

ResponsabilitÃ© unique pour chaque classe/module
Ouvert Ã  l'extension, fermÃ© Ã  la modification
Substitution de Liskov pour les interfaces
SÃ©grÃ©gation des interfaces
Inversion des dÃ©pendances


ModularitÃ© et ExtensibilitÃ©:

Interfaces claires entre modules
Factory patterns pour la crÃ©ation d'objets
Registres pour les composants extensibles


CompatibilitÃ© Colab:

Gestion de l'environnement via abstraction
Installation efficace des dÃ©pendances
ConsidÃ©ration des limites de mÃ©moire et processeurs


Documentation:

Docstrings complets pour toutes les classes/fonctions
Fichiers README pour chaque module
Exemples d'utilisation
RÃ©sumÃ©s de module dans /summary_tmp/

Fichiers de rÃ©fÃ©rence

Code legacy: archive/data_preparation/forestgaps_dl_data_preparation.py et archive/unet_training/forestgaps_dl_u_net_training.py
Objectifs: archive/Objectif de migration.txt
RÃ©sumÃ©s des modules: Consultez summary_tmp/ pour les modules dÃ©jÃ  implÃ©mentÃ©s

Gestion de session
Ã€ la fin de chaque session majeure:

GÃ©nÃ©rer un fichier achievements.md dÃ©crivant les fonctionnalitÃ©s implÃ©mentÃ©es
Mettre Ã  jour ce prompt de contexte avec les nouveaux modules terminÃ©s
Documenter les API importantes dans module_interfaces.md

TÃ¢che actuelle : Architectures U-Net et leurs variantes (Ã  implÃ©menter)